# üîç Anomaly Detection with Anomalib (PaDiM + ResNet18)

‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ú‡∏¥‡∏î‡∏õ‡∏Å‡∏ï‡∏¥‡πÉ‡∏ô‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û (Visual Anomaly Detection) ‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ **PaDiM** (Patch Distribution Modeling) ‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏±‡∏ö **ResNet18** ‡πÄ‡∏õ‡πá‡∏ô backbone ‡∏ú‡πà‡∏≤‡∏ô library [Anomalib](https://github.com/openvinotoolkit/anomalib)

---

## üìã ‡∏™‡∏≤‡∏£‡∏ö‡∏±‡∏ç

- [‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°](#-‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°)
- [‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå](#-‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå)
- [‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á](#-‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á)
- [‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏° Dataset](#-‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°-dataset)
- [‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô](#-‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô)
- [‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ](#-‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ)
- [Dependencies ‡∏´‡∏•‡∏±‡∏Å](#-dependencies-‡∏´‡∏•‡∏±‡∏Å)

---

## üß© ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°

‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡πÅ‡∏ö‡πà‡∏á‡∏≠‡∏≠‡∏Å‡πÄ‡∏õ‡πá‡∏ô 2 ‡∏™‡πà‡∏ß‡∏ô‡∏´‡∏•‡∏±‡∏Å:

| ‡πÑ‡∏ü‡∏•‡πå | ‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà |
|------|---------|
| `anomalib_train 18.py` | Train ‡πÇ‡∏°‡πÄ‡∏î‡∏• PaDiM ‡∏î‡πâ‡∏ß‡∏¢ ResNet18 ‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å checkpoint |
| `detect_images.py` | ‡πÇ‡∏´‡∏•‡∏î‡πÇ‡∏°‡πÄ‡∏î‡∏•‡∏ó‡∏µ‡πà train ‡πÅ‡∏•‡πâ‡∏ß‡∏°‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ú‡∏¥‡∏î‡∏õ‡∏Å‡∏ï‡∏¥‡πÉ‡∏ô‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û |

### ‡∏≠‡∏±‡∏•‡∏Å‡∏≠‡∏£‡∏¥‡∏ó‡∏∂‡∏° PaDiM

PaDiM ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÇ‡∏î‡∏¢:
1. ‡∏î‡∏∂‡∏á **feature maps** ‡∏à‡∏≤‡∏Å layer ‡∏Ç‡∏≠‡∏á ResNet18 (`layer1`, `layer2`, `layer3`)
2. ‡∏™‡∏£‡πâ‡∏≤‡∏á **Multivariate Gaussian Distribution** ‡∏à‡∏≤‡∏Å‡∏£‡∏π‡∏õ Normal ‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á Training
3. ‡πÉ‡∏ô‡∏Ç‡∏±‡πâ‡∏ô Inference ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì **Mahalanobis Distance** ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á Anomaly Score ‡πÅ‡∏•‡∏∞ Heat Map

---

## üìÅ ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå

```
üì¶ project/
‚îú‚îÄ‚îÄ anomalib_train 18.py    # Script ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Training
‚îú‚îÄ‚îÄ detect_images.py        # Script ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Detection
‚îú‚îÄ‚îÄ requirements.txt        # Python dependencies
‚îî‚îÄ‚îÄ dataset/
    ‚îú‚îÄ‚îÄ normal/             # ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏õ‡∏Å‡∏ï‡∏¥ (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Training)
    ‚îî‚îÄ‚îÄ abnormal/           # ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏ú‡∏¥‡∏î‡∏õ‡∏Å‡∏ï‡∏¥ (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Testing/Validation)
```

**‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å Train ‡πÅ‡∏•‡πâ‡∏ß‡∏à‡∏∞‡∏°‡∏µ‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÄ‡∏û‡∏¥‡πà‡∏°:**

```
üì¶ project/
‚îú‚îÄ‚îÄ results/                # ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£ Training ‡πÅ‡∏•‡∏∞ Testing
‚îÇ   ‚îî‚îÄ‚îÄ model.ckpt          # Model checkpoint
‚îî‚îÄ‚îÄ detection_results/      # ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£ Detection
    ‚îú‚îÄ‚îÄ <image>_result.png  # ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°: Original + Heatmap + Overlay
    ‚îî‚îÄ‚îÄ <image>_heatmap.png # Anomaly Heat Map ‡πÅ‡∏¢‡∏Å
```

---

## ‚öôÔ∏è ‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á

### 1. Clone repository

```bash
git clone <repository-url>
cd <repository-folder>
```

### 2. ‡∏™‡∏£‡πâ‡∏≤‡∏á Virtual Environment (‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥)

```bash
python -m venv venv
venv\Scripts\activate       # Windows
# ‡∏´‡∏£‡∏∑‡∏≠
source venv/bin/activate    # Linux/macOS
```

### 3. ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á Dependencies

```bash
pip install -r requirements.txt
```

> ‚ö†Ô∏è **‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:** ‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡∏ô‡∏µ‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÉ‡∏´‡πâ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô **Offline** ‡πÇ‡∏î‡∏¢‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå (‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏≠‡∏¥‡∏ô‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡πá‡∏ï)  
> ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ weights ‡∏Ç‡∏≠‡∏á ResNet18 ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô cache ‡∏Ç‡∏≠‡∏á PyTorch ‡∏Å‡πà‡∏≠‡∏ô ‡∏´‡∏£‡∏∑‡∏≠‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ß‡πâ‡∏•‡πà‡∏ß‡∏á‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏•‡πâ‡∏ß

---

## üóÇÔ∏è ‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏° Dataset

‡∏ß‡∏≤‡∏á‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÉ‡∏ô‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå `dataset/` ‡∏ï‡∏≤‡∏°‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ô‡∏µ‡πâ:

```
dataset/
‚îú‚îÄ‚îÄ normal/       ‚Üê ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏ó‡∏µ‡πà "‡∏õ‡∏Å‡∏ï‡∏¥" ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Training)
‚îî‚îÄ‚îÄ abnormal/     ‚Üê ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏ó‡∏µ‡πà "‡∏ú‡∏¥‡∏î‡∏õ‡∏Å‡∏ï‡∏¥" (‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Testing/Evaluation)
```

- ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÑ‡∏ü‡∏•‡πå: `.jpg`, `.jpeg`, `.png`, `.bmp`, `.tiff`
- ‡πÑ‡∏°‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ Label ‡∏´‡∏£‡∏∑‡∏≠ Annotation ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° (‡πÄ‡∏õ‡πá‡∏ô Unsupervised learning)
- ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ‡∏°‡∏µ‡∏£‡∏π‡∏õ Normal ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ **50-100 ‡∏£‡∏π‡∏õ** ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û‡∏ó‡∏µ‡πà‡∏î‡∏µ

---

## üöÄ ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô

### ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 1: Train ‡πÇ‡∏°‡πÄ‡∏î‡∏•

‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç path ‡πÉ‡∏ô `anomalib_train 18.py`:

```python
# ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç path ‡∏Ç‡∏≠‡∏á dataset
root=r"C:/your/path/to/dataset"

# ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç path ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå
results_dir = Path(r"C:/your/path/to/results")
```

‡∏à‡∏≤‡∏Å‡∏ô‡∏±‡πâ‡∏ô‡∏£‡∏±‡∏ô:

```bash
python "anomalib_train 18.py"
```

‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡∏à‡∏∞:
- ‚úÖ Train ‡πÇ‡∏°‡πÄ‡∏î‡∏• PaDiM
- ‚úÖ Test ‡πÇ‡∏°‡πÄ‡∏î‡∏•‡πÅ‡∏•‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏π‡∏õ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå
- ‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å checkpoint ‡∏ó‡∏µ‡πà `results/model.ckpt`

---

### ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 2: ‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ú‡∏¥‡∏î‡∏õ‡∏Å‡∏ï‡∏¥

‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç path ‡πÉ‡∏ô `detect_images.py`:

```python
# path ‡∏Ç‡∏≠‡∏á checkpoint ‡∏ó‡∏µ‡πà train ‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß
CHECKPOINT_PATH = r"C:/your/path/to/results/model.ckpt"

# path ‡∏Ç‡∏≠‡∏á‡∏£‡∏π‡∏õ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö
IMAGE_PATH = r"C:/your/path/to/test_image.jpg"

# path ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå
OUTPUT_DIR = r"C:/your/path/to/detection_results"
```

‡∏à‡∏≤‡∏Å‡∏ô‡∏±‡πâ‡∏ô‡∏£‡∏±‡∏ô:

```bash
python detect_images.py
```

#### ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ó‡∏±‡πâ‡∏á‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå

‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÉ‡∏ô `detect_images.py` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏π‡∏õ‡∏´‡∏•‡∏≤‡∏¢‡∏£‡∏π‡∏õ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ô:

```python
# Uncomment ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ô‡∏µ‡πâ
IMAGE_FOLDER = r"C:/your/path/to/image_folder"
results = detect_multiple_images(IMAGE_FOLDER, CHECKPOINT_PATH, OUTPUT_DIR)
```

---

## üìä ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ

### ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£ Detection

‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏£‡∏π‡∏õ‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏à‡∏∞‡πÑ‡∏î‡πâ output ‡∏î‡∏±‡∏á‡∏ô‡∏µ‡πâ:

| ‡πÑ‡∏ü‡∏•‡πå | ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ |
|------|-----------|
| `<image>_result.png` | ‡∏†‡∏≤‡∏û 3-panel: ‡∏£‡∏π‡∏õ‡∏ï‡πâ‡∏ô‡∏â‡∏ö‡∏±‡∏ö / Anomaly Heat Map / Overlay |
| `<image>_heatmap.png` | Anomaly Heat Map ‡πÅ‡∏¢‡∏Å‡πÑ‡∏ü‡∏•‡πå |

### ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏ö‡∏ô Console

```
============================================================
DETECTION RESULT
============================================================
Anomaly Score: 0.7832
Status: ABNORMAL ‚ùå
============================================================

‚úì Result saved to: detection_results/image_result.png
‚úì Heatmap saved to: detection_results/image_heatmap.png
```

### ‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏´‡∏•‡∏≤‡∏¢‡∏£‡∏π‡∏õ

```
============================================================
SUMMARY
============================================================
Total images: 10
Normal: 7
Abnormal: 3
============================================================
```

---

## üì¶ Dependencies ‡∏´‡∏•‡∏±‡∏Å

| Package | Version | ‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà |
|---------|---------|---------|
| `anomalib` | 1.2.0 | Core anomaly detection library |
| `torch` / `torchvision` | - | Deep learning framework |
| `opencv-python` (cv2) | - | ‡∏≠‡πà‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û |
| `matplotlib` | - | ‡∏™‡∏£‡πâ‡∏≤‡∏á visualization ‡πÅ‡∏•‡∏∞ heat map |
| `numpy` | - | ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ array ‡∏Ç‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• |

---

## üìù ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏

- ‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ `TRANSFORMERS_OFFLINE=1` ‡πÅ‡∏•‡∏∞ `HF_HUB_OFFLINE=1` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏≠‡∏¥‡∏ô‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡πá‡∏ï
- ‡πÉ‡∏ä‡πâ `pre_trained=False` ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÇ‡∏´‡∏•‡∏î backbone ‡∏à‡∏≤‡∏Å local cache
- ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö GPU ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏´‡∏≤‡∏Å CUDA ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô

---

## üìÑ License

This project uses [Anomalib](https://github.com/openvinotoolkit/anomalib) which is licensed under the Apache License 2.0.
